import{_ as i,c as a,a as n,o as l}from"./app-BJNIPHqW.js";const h={};function t(k,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="工具类统一封装" tabindex="-1"><a class="header-anchor" href="#工具类统一封装"><span>工具类统一封装</span></a></h2><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#B392F0;"> ThreadPoolConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">    /**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     * CPU 密集型线程池（计算、加解密、编解码）</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">Bean</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;cpuExecutor&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> ExecutorService</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> cpuExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> Runtime</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">getRuntime</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">availableProcessors</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        ThreadPoolExecutor</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> executor </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> ThreadPoolExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                n, n, </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">0L</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">MILLISECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> LinkedBlockingQueue</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">&lt;&gt;(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> ThreadFactoryBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">setNameFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;cpu-%d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> ThreadPoolExecutor.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">AbortPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">()); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 队列满直接抛异常，方便早发现</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">        // Micrometer 监控</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">        Metrics</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">gauge</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;thread.pool.cpu.active&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, executor, ThreadPoolExecutor</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">getActiveCount);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> executor;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">    /**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     * IO 密集型线程池（远程调用、DB、文件）</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">Bean</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;ioExecutor&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> ExecutorService</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> ioExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        ThreadPoolExecutor</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> executor </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> ThreadPoolExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">                50</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">60L</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">SECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> LinkedBlockingQueue</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">&lt;&gt;(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> ThreadFactoryBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">setNameFormat</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;io-%d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                new</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> ThreadPoolExecutor.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">CallerRunsPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">()); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 队列满由调用线程执行，保证不丢任务</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">        Metrics</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">gauge</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;thread.pool.io.active&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, executor, ThreadPoolExecutor</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">getActiveCount);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> executor;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">    /**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     * Spring 优雅关闭</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">     */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">PreDestroy</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> shutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">        gracefulShutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">ioExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">        gracefulShutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">cpuExecutor</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> gracefulShutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">ExecutorService</span><span style="--shiki-light:#383A42;--shiki-dark:#FFAB70;"> pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">        pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">shutdown</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">awaitTermination</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">SECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">shutdownNow</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">            pool</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">shutdownNow</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">            Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">interrupt</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><h2 id="async" tabindex="-1"><a class="header-anchor" href="#async"><span>@Async</span></a></h2><blockquote><p>@Async注解用于异步方法，异步方法调用不会阻塞当前线程，异步方法调用会返回一个Future对象，可以通过Future对象获取异步方法执行结果。</p></blockquote><div class="hint-container tip"><p class="hint-container-title">提示</p><p>相同类中调用async同步方法会失效， Spring 的 @Async 是靠 AOP 代理实现的，同类内部调用不走代理，注解自然失效。</p></div><h2 id="completablefuture" tabindex="-1"><a class="header-anchor" href="#completablefuture"><span>CompletableFuture</span></a></h2><p><em><strong>1.创建任务</strong></em></p><table><thead><tr><th>方法</th><th>是否有返回值</th><th>是否可指定线程池</th><th>用途</th></tr></thead><tbody><tr><td><code>runAsync(Runnable)</code></td><td>❌</td><td>✅（可选）</td><td>只执行，不要结果</td></tr><tr><td><code>supplyAsync(Supplier&lt;T&gt;)</code></td><td>✅</td><td>✅（可选）</td><td>执行并带回结果</td></tr><tr><td><code>completedFuture(T)</code></td><td>✅</td><td>—</td><td>直接给一个现成的结果</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; f1 </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;"> &quot;hello&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><em><strong>2.串行编排（结果传递）</strong></em></p><table><thead><tr><th>方法</th><th>同步/异步</th><th>入参</th><th>出参</th><th>常见场景</th></tr></thead><tbody><tr><td><code>thenApply(fn)</code></td><td>同步</td><td>T → U</td><td><code>CompletableFuture&lt;U&gt;</code></td><td>转换结果</td></tr><tr><td><code>thenCompose(fn)</code></td><td>异步</td><td>T → <code>CompletableFuture&lt;U&gt;</code></td><td><code>CompletableFuture&lt;U&gt;</code></td><td>链式调用</td></tr><tr><td><code>thenAccept(consumer)</code></td><td>同步</td><td>T → void</td><td><code>CompletableFuture&lt;Void&gt;</code></td><td>纯消费</td></tr><tr><td><code>thenRun(runnable)</code></td><td>同步</td><td>→ void</td><td><code>CompletableFuture&lt;Void&gt;</code></td><td>不关心结果</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; f </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        CompletableFuture</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">thenApply</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(i </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 20</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">thenCompose</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(n </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 21</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>3. 并行汇聚（等多任务）</strong></em></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>thenCombine(cf2, fn)</code></td><td>两个都完成后合并结果</td></tr><tr><td><code>thenAcceptBoth(cf2, consumer)</code></td><td>两个都完成后消费</td></tr><tr><td><code>runAfterBoth(cf1, cf2, runnable)</code></td><td>两个都完成后仅执行动作</td></tr><tr><td><code>applyToEither(cf2, fn)</code></td><td>任意一个完成就转换</td></tr><tr><td><code>acceptEither(cf2, consumer)</code></td><td>任意一个完成就消费</td></tr><tr><td><code>runAfterEither(cf1, cf2, runnable)</code></td><td>任意一个完成就执行动作</td></tr><tr><td><code>allOf(cf...)</code></td><td>等全部完成，结果为空</td></tr><tr><td><code>anyOf(cf...)</code></td><td>任意一个完成即可</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; f1 </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;"> &quot;A&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; f2 </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;"> &quot;B&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> both </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> f1</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">thenCombine</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(f2, (a, b) </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> b).</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// AB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>4. 异常处理</strong></em></p><table><thead><tr><th>方法</th><th>触发时机</th><th>能否返回替代值</th><th>备注</th></tr></thead><tbody><tr><td><code>exceptionally(fn)</code></td><td><strong>异常时</strong></td><td>✅</td><td>只补异常</td></tr><tr><td><code>handle(fn)</code></td><td><strong>任何结果</strong></td><td>✅</td><td>成功/异常都会进</td></tr><tr><td><code>whenComplete(consumer)</code></td><td><strong>任何结果</strong></td><td>❌</td><td>类似 finally，不能改返回值</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; f </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        CompletableFuture</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 异常</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">exceptionally</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(ex </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">// 返回 -1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>5. 超时 &amp; 兜底</strong></em></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>orTimeout(time, unit)</code></td><td>超时报 <code>TimeoutException</code></td></tr><tr><td><code>completeOnTimeout(value, time, unit)</code></td><td>超时给默认值</td></tr></tbody></table><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> CompletableFuture</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> heavy</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">completeOnTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;timeout&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">SECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">           .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>6. 获取最终值（收尾）</strong></em></p><table><thead><tr><th>方法</th><th>区别</th></tr></thead><tbody><tr><td><code>get()</code></td><td><strong>抛受检异常</strong>，必须 try-catch</td></tr><tr><td><code>join()</code></td><td><strong>不抛受检异常</strong>，直接抛运行时异常</td></tr><tr><td><code>getNow(default)</code></td><td>立即拿值，没好就返回 default</td></tr><tr><td><code>isDone()</code> / <code>isCompletedExceptionally()</code></td><td>状态探测</td></tr></tbody></table><ul><li>@Async常用于没有返回值的方法中</li><li>CompletableFuture ：处理多个任务，返回一个结果</li></ul><h2 id="deferredresult、callable、webflux" tabindex="-1"><a class="header-anchor" href="#deferredresult、callable、webflux"><span>DeferredResult、Callable、WebFlux</span></a></h2><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e;"><pre class="shiki shiki-themes one-light github-dark vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">SneakyThrows</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> Callable</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">Set</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">  asgs</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">Map</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt;&gt; one </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">4000</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(e);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">                    &quot;one&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">            );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">Map</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt;&gt; two </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">allOf</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                        CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                            try</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">4000</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                                throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(e);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                            }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;tow1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">21</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                        }),</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                        CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                            try</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                                Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">4000</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                            } </span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#FFAB70;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                                throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(e);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                            }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;tow2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">22</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                        })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                ).</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">thenApply</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(nil </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;">                    // 把两个结果合并</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">                    Map</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; m </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> HashMap</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                    m</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;two&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> m;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                });</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">        CompletableFuture</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">Map</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt;&gt; three </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">supplyAsync</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">                &quot;three&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">        ));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;"> CompletableFuture</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">allOf</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(one, two, three)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">thenApply</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;">                    Set</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">&gt; result </span><span style="--shiki-light:#383A42;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E1E4E8;"> HashSet</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                    result</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">one</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">keySet</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                    result</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">two</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">keySet</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">                    result</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">three</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">keySet</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#F97583;">                    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">completeOnTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">Collections</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">singleton</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#9ECBFF;">&quot;超时&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#986801;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E1E4E8;">SECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><blockquote><p>全文来自kimi-ai</p><p>其实工作还没用到过CompletableFuture 只用过Async</p><p>今天九点起床闹钟响一个小时硬是没叫醒我</p></blockquote>`,27)]))}const p=i(h,[["render",t]]),d=JSON.parse('{"path":"/blog/worklogs/CompletableFuture.html","title":"异步编排","lang":"zh-CN","frontmatter":{"title":"异步编排","icon":"streamline-freehand-color:fireworks-2","order":2,"description":"异步任务编排器","category":["work"],"tag":["异步"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"异步编排\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-28T14:16:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mishu\\",\\"url\\":\\"https://github.com/ToTryEveryThing/my-docs\\"}]}"],["meta",{"property":"og:url","content":"https://docs.beink.cn/blog/worklogs/CompletableFuture.html"}],["meta",{"property":"og:title","content":"异步编排"}],["meta",{"property":"og:description","content":"异步任务编排器"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-28T14:16:53.000Z"}],["meta",{"property":"article:tag","content":"异步"}],["meta",{"property":"article:modified_time","content":"2025-08-28T14:16:53.000Z"}]]},"git":{"createdTime":1755787379000,"updatedTime":1756390613000,"contributors":[{"name":"mishu","username":"mishu","email":"riceuncle@outlook.com","commits":2,"url":"https://github.com/mishu"}],"changelog":[{"hash":"f31f6612b25967bebdd2052d1761f3c6f491e5a4","time":1756390613000,"email":"riceuncle@outlook.com","author":"mishu","message":"Spring事件发布与监听"},{"hash":"2227af357228433e9b0a7b607335a22902fba502","time":1755787379000,"email":"riceuncle@outlook.com","author":"mishu","message":"异步任务编排器"}]},"readingTime":{"minutes":3.19,"words":956},"filePathRelative":"blog/worklogs/CompletableFuture.md","excerpt":"<h2>工具类统一封装</h2>\\n<div class=\\"language-java line-numbers-mode has-collapsed-lines collapsed\\" data-highlighter=\\"shiki\\" data-ext=\\"java\\" style=\\"--vp-collapsed-lines:15;--shiki-light:#383A42;--shiki-dark:#e1e4e8;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#24292e\\"><pre class=\\"shiki shiki-themes one-light github-dark vp-code\\"><code class=\\"language-java\\"><span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">@</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">Configuration</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">public</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\"> class</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#B392F0\\"> ThreadPoolConfig</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">    /**</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     * CPU 密集型线程池（计算、加解密、编解码）</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     */</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">Bean</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"cpuExecutor\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\"> ExecutorService</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> cpuExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">() {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">        int</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\"> n </span><span style=\\"--shiki-light:#383A42;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\"> Runtime</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">getRuntime</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">().</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">availableProcessors</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\">        ThreadPoolExecutor</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\"> executor </span><span style=\\"--shiki-light:#383A42;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> ThreadPoolExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">                n, n, </span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">0L</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">TimeUnit</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">MILLISECONDS</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\"> LinkedBlockingQueue</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">&lt;&gt;(</span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">1000</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">),</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> ThreadFactoryBuilder</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">().</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">setNameFormat</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"cpu-%d\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">).</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">build</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(),</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> ThreadPoolExecutor.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">AbortPolicy</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">()); </span><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">// 队列满直接抛异常，方便早发现</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">        // Micrometer 监控</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">        Metrics</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">gauge</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"thread.pool.cpu.active\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, executor, ThreadPoolExecutor</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">::</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">getActiveCount);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> executor;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">    /**</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     * IO 密集型线程池（远程调用、DB、文件）</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     */</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">Bean</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"ioExecutor\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">)</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\"> ExecutorService</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> ioExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">() {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\">        ThreadPoolExecutor</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\"> executor </span><span style=\\"--shiki-light:#383A42;--shiki-dark:#F97583\\">=</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\"> new</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> ThreadPoolExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">                50</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">200</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">60L</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">TimeUnit</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">SECONDS</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\"> LinkedBlockingQueue</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">&lt;&gt;(</span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">5000</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">),</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> ThreadFactoryBuilder</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">().</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">setNameFormat</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"io-%d\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">).</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">build</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(),</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">                new</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> ThreadPoolExecutor.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">CallerRunsPolicy</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">()); </span><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">// 队列满由调用线程执行，保证不丢任务</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">        Metrics</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">gauge</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#9ECBFF\\">\\"thread.pool.io.active\\"</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, executor, ThreadPoolExecutor</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">::</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">getActiveCount);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">        return</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> executor;</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">    /**</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     * Spring 优雅关闭</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit\\">     */</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    @</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">PreDestroy</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">    public</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\"> void</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> shutdown</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">() {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">        gracefulShutdown</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">ioExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">());</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">        gracefulShutdown</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">cpuExecutor</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">());</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">    private</span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\"> void</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\"> gracefulShutdown</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\">ExecutorService</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#FFAB70\\"> pool</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">        pool</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">shutdown</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">        try</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">            if</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> (</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#F97583\\">!</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">pool</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">awaitTermination</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">(</span><span style=\\"--shiki-light:#986801;--shiki-dark:#79B8FF\\">10</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">, </span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">TimeUnit</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">SECONDS</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">)) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">                pool</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">shutdownNow</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">            }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">        } </span><span style=\\"--shiki-light:#A626A4;--shiki-dark:#F97583\\">catch</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\"> (</span><span style=\\"--shiki-light:#C18401;--shiki-dark:#E1E4E8\\">InterruptedException</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#FFAB70\\"> e</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">) {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">            pool</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">shutdownNow</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E45649;--shiki-dark:#E1E4E8\\">            Thread</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">.</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">currentThread</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">().</span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#B392F0\\">interrupt</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">();</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">        }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#E1E4E8\\">}</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div><div class=\\"collapsed-lines\\"></div></div>"}');export{p as comp,d as data};
